generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum StatusAgendamento {
  PENDENTE
  REALIZADO
  CANCELADO
}

model Agendamento {
  id_agendamento     Int      @id @default(autoincrement())
  dia_agendado       DateTime
  turno_agendado     String
  observacoes        String?
  dia_realizado      DateTime?    // Adicionado
  horario_realizado  String?      // Adicionado
  id_cliente         Int
  id_usuario         Int
  id_zona            Int?
  status             StatusAgendamento @default(PENDENTE)

  cliente Cliente @relation(fields: [id_cliente], references: [id_cliente], onDelete: Cascade)
  usuario Usuario @relation(fields: [id_usuario], references: [id_usuario])
  zona    Zona?   @relation(fields: [id_zona], references: [id])

  @@map("agendamentos")
}

enum TipoCliente {
  GRANDE_GERADOR
  PEQUENO_GERADOR
}

model Cliente {
  id_cliente       Int           @id @default(autoincrement())
  nome_cliente     String
  tipo             TipoCliente   @default(PEQUENO_GERADOR)
  telefone_cliente String        @unique
  qr_code          String?       @unique
  id_endereco      Int
  

  endereco     Endereco   @relation(fields: [id_endereco], references: [id_endereco], onDelete: Cascade)
  agendamentos Agendamento[]
  coletas      Coleta[]

  @@map("clientes")
}

model Coleta {
  id_coleta         Int      @id @default(autoincrement())
  dia_realizado     DateTime
  horario_realizado DateTime
  id_cliente        Int
  id_usuario        Int

  cliente Cliente @relation(fields: [id_cliente], references: [id_cliente], onDelete: Cascade)
  usuario Usuario @relation(fields: [id_usuario], references: [id_usuario])

  @@map("coletas")
}

model Endereco {
  id_endereco Int     @id @default(autoincrement())
  nome_rua    String
  numero      String
  bairro      String
  id_zona     Int

  zona     Zona      @relation(fields: [id_zona], references: [id])
  clientes Cliente[]

  @@map("enderecos")
}

model Usuario {
  id_usuario   Int    @id @default(autoincrement())
  nome         String
  email        String @unique
  senha        String
  tipo_usuario String

  agendamentos Agendamento[]
  coletas      Coleta[]

  @@map("usuarios")
}

model Zona {
  id                    Int      @id @default(autoincrement())
  nome_da_zona          String   @unique
  qtd_coletas_esperadas Int
  dias                  Json
  cor                   String

  enderecos    Endereco[]
  agendamentos Agendamento[]

  @@map("zonas")
}
